- clean: ['~']

- shell:
    - command: |
        if ! command -v brew &>/dev/null; then
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        fi
      description: Install Homebrew
      stdout: true
      stderr: true
      stdin: true 

    - command: |
        if [ ! -d "$HOME/.oh-my-zsh" ]; then
          sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
        fi
      description: Install Oh My Zsh
      stdout: true
      stderr: true

- link:
    ~/.gitconfig: gitconfig
    ~/.gitconfig_private: gitconfig_private
    ~/.gitignore_global: gitignore_global
    ~/.ssh/config:
        path: ssh/config
        create: true
    ~/.zprofile: zprofile
    ~/.zshrc: zshrc
    ~/.Brewfile: Brewfile
    ~/.config/1Password/ssh/agent.toml:
        path: "1Password/ssh/agent.toml"
        create: true

- shell:
    - command: brew bundle install --global --upgrade
      description: Install Brewfile packages
      stdout: true
      stderr: true

- shell:
    - command: |
        if [ ! -d "/Library/Keyboard Layouts/Roman.bundle" ]; then
          echo "Installing USGerman keyboard layout..."
          unzip -q USGermanKeyboardLayout.zip -d /tmp/USGerman
          sudo cp -R /tmp/USGerman/*/Roman.bundle "/Library/Keyboard Layouts/"
          rm -rf /tmp/USGerman
          echo "✓ USGerman keyboard layout installed"
          echo "⚠ Remember to: System Settings → Keyboard → Input Sources → + → Others → U.S. With Umlauts via Option Key"
          echo "⚠ Log out and back in once to activate it fully"
        else
          echo "✓ USGerman keyboard layout already installed"
        fi
      description: Install USGerman keyboard layout
      stdout: true
      stderr: true
      stdin: true
